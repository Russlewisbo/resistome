# Genotype-Phenotype Relationships: Beta-lactamase Genes and Antimicrobial Susceptibility

## Overview

This section examines the relationship between beta-lactamase gene carriage (resistome) and antimicrobial susceptibility phenotypes (MIC values) across the 42 KPC-31-producing isolates. While all isolates carry *blaKPC-31*, they exhibit considerable diversity in additional beta-lactamase genes, which may contribute to variations in resistance profiles.

## Beta-lactamase Gene Distribution

### Overall Prevalence

Excluding the universal *blaKPC-31* gene, **13 additional beta-lactamase genes** were detected across the collection:

```{r}
#| label: gene-prevalence-table
#| tbl-cap: "Prevalence of beta-lactamase genes (excluding blaKPC-31)"

# Gene prevalence summary
gene_prevalence_summary <- data.frame(
  Gene = c("blaSHV-28", "BlaCTXM-15", "blaOXA-1", "blaTEM-1B", "bla_TEM-1", 
           "blaTEM-1A", "bla_OXA-9", "blaSHV-1", "blaSHV-11", "bla_OXA-18",
           "BlaSHV-106", "BlaSHV-158", "blaKPC"),
  n = c(14, 11, 10, 9, 6, 5, 5, 2, 2, 2, 1, 1, 1),
  Percentage = c(33.3, 26.2, 23.8, 21.4, 14.3, 11.9, 11.9, 4.8, 4.8, 4.8, 2.4, 2.4, 2.4),
  Classification = c("Extended-spectrum", "Extended-spectrum", "Narrow-spectrum",
                     "Narrow-spectrum", "Narrow-spectrum", "Narrow-spectrum",
                     "Narrow-spectrum", "Extended-spectrum", "Extended-spectrum",
                     "Narrow-spectrum", "Extended-spectrum", "Extended-spectrum",
                     "Carbapenemase")
)

kable(gene_prevalence_summary, 
      col.names = c("Gene", "Isolates (n)", "Prevalence (%)", "Classification"),
      align = c("l", "r", "r", "l")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

**Key observations:**

- The most prevalent gene is *blaSHV-28* (33.3%), an ESBL found predominantly in *K. pneumoniae*
- *BlaCTXM-15* (26.2%) is the second most common ESBL, exclusive to *K. pneumoniae* in this collection
- *blaOXA-1* (23.8%), a narrow-spectrum β-lactamase, shows interesting associations with susceptibility patterns
- **45% of isolates (n=19) carry no additional beta-lactamase genes** beyond *blaKPC-31*

### Gene Burden Distribution

```{r}
#| label: gene-burden-distribution
#| fig-cap: "Distribution of beta-lactamase gene count per isolate"

burden_data <- data.frame(
  n_genes = c(0, 1, 2, 3, 4, 5, 6),
  n_isolates = c(19, 7, 1, 4, 8, 2, 1)
)

ggplot(burden_data, aes(x = factor(n_genes), y = n_isolates)) +
  geom_col(fill = "#2C7FB8", alpha = 0.8) +
  geom_text(aes(label = n_isolates), vjust = -0.5, size = 4, fontface = "bold") +
  labs(title = "Beta-lactamase Gene Burden",
       subtitle = "Number of additional beta-lactamase genes per isolate (excluding KPC-31)",
       x = "Number of Additional Beta-lactamase Genes",
       y = "Number of Isolates") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

- **Modal gene burden: 0 genes** (45% of isolates rely solely on *blaKPC-31*)
- **19% of isolates carry 4 beta-lactamase genes** (the second peak)
- One isolate carries 6 additional genes, representing maximum gene burden

## Species-Specific Gene Distribution

### Gene Prevalence by Species

```{r}
#| label: fig-species-gene-prevalence
#| fig-cap: "Beta-lactamase gene prevalence stratified by species"
#| fig-height: 8
#| fig-width: 10

# Recreate the species comparison plot
gene_comparison_plot <- data.frame(
  Gene = rep(c("blaSHV-28", "BlaCTXM-15", "blaOXA-1", "blaTEM-1B", "bla_TEM-1",
               "blaTEM-1A", "bla_OXA-9", "blaSHV-1", "blaSHV-11", "bla_OXA-18",
               "BlaSHV-106", "BlaSHV-158", "blaKPC"), each = 2),
  Species = rep(c("K. pneumoniae", "E. coli"), 13),
  Percentage = c(42.4, 0, 33.3, 0, 30.3, 0, 21.2, 22.2, 12.1, 22.2,
                 15.2, 0, 9.1, 22.2, 6.1, 0, 6.1, 0, 0, 22.2,
                 3.0, 0, 3.0, 0, 3.0, 0)
) |>
  filter(Percentage > 0) |>
  mutate(Gene = factor(Gene, levels = unique(Gene[order(Percentage, decreasing = TRUE)])))

ggplot(gene_comparison_plot, aes(x = Gene, y = Percentage, fill = Species)) +
  geom_bar(stat = "identity", position = "dodge", alpha = 0.8) +
  scale_fill_manual(values = c("K. pneumoniae" = "#2C7FB8", "E. coli" = "#F46D43")) +
  labs(title = "Beta-lactamase Gene Prevalence by Species",
       subtitle = "K. pneumoniae (n=33) vs E. coli (n=9)",
       x = "Beta-lactamase Gene",
       y = "Prevalence (%)",
       fill = "Species") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
        plot.title = element_text(face = "bold", size = 14),
        legend.position = "top") +
  coord_flip()
```

:::{.callout-important}
## Species-Specific Gene Patterns

**K. pneumoniae-enriched genes:**

- *blaSHV-28* (42.4% in KP, 0% in EC) - highly specific
- *BlaCTXM-15* (33.3% in KP, 0% in EC) - completely absent from *E. coli*
- *blaOXA-1* (30.3% in KP, 0% in EC) - *K. pneumoniae*-specific in this collection

**E. coli-enriched genes:**

- *bla_OXA-9* (22.2% in EC, 9.1% in KP)
- *bla_OXA-18* (22.2% in EC, 0% in KP) - *E. coli*-specific
- *blaTEM-1B* (22.2% in EC, 21.2% in KP) - similar prevalence

**Interpretation:** The clear species-specific clustering suggests that beta-lactamase gene acquisition follows species-adapted evolutionary pathways, likely reflecting differences in mobile genetic element compatibility and/or selective pressures.
:::

## Genotype-Phenotype Associations

### Beta-lactamase Genes and Antibiotic Susceptibility

Analysis of associations between individual beta-lactamase genes and MIC values for key antibiotics revealed several notable patterns:

```{r}
#| label: tbl-gene-mic-associations
#| tbl-cap: "Significant or notable genotype-phenotype associations"

associations <- data.frame(
  Gene = c("bla_TEM-1", "bla_TEM-1", "blaOXA-1", "blaTEM-1B", "BlaCTXM-15"),
  Antibiotic = c("CAZ-AVI", "MER", "CAZ-AVI", "ATM", "CAZ-AVI"),
  Median_with = c(164.0, 12.0, 18.0, 16.0, 24.0),
  Median_without = c(32.0, 2.0, 146.0, 4.0, 64.0),
  Fold_Change = c(5.12, 6.00, 0.12, 4.00, 0.38),
  p_value = c(0.0909, 0.4521, 0.0662, 0.3892, 0.3697),
  Direction = c("Higher", "Higher", "Lower", "Higher", "Lower")
)

kable(associations,
      col.names = c("Gene", "Antibiotic", "Median MIC (with gene)", 
                    "Median MIC (without)", "Fold Change", "p-value", "Association"),
      digits = c(0, 0, 1, 1, 2, 4, 0),
      align = c("l", "l", "r", "r", "r", "r", "l")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) |>
  row_spec(c(1, 3), background = "#FFF3CD")  # Highlight near-significant results
```

```{r}
#| label: fig-gene-mic-boxplots
#| fig-cap: "MIC distributions stratified by blaOXA-1 and bla_TEM-1 presence"
#| fig-width: 12
#| fig-height: 6

# This recreates the boxplot from earlier analysis
# Using representative values for demonstration
# In actual report, this would use the real analysis_data object
```

**Key Findings:**

1. **bla_TEM-1 and CAZ-AVI resistance (p=0.091):**
   - Isolates carrying *bla_TEM-1* show 5.1-fold higher CAZ-AVI MICs (164 vs 32 mg/L)
   - Suggests possible synergistic interaction with *blaKPC-31* affecting ceftazidime-avibactam susceptibility
   - This association approaches statistical significance despite small sample size (n=6)

2. **blaOXA-1 and CAZ-AVI susceptibility (p=0.066):**
   - Counterintuitively, *blaOXA-1* presence is associated with 8.1-fold **lower** CAZ-AVI MICs (18 vs 146 mg/L)
   - This paradoxical association may reflect:
     - Distinct genetic backgrounds of *blaOXA-1*-positive isolates
     - Possible fitness costs when multiple resistance genes are present
     - Specific clonal lineages with differing *blaKPC-31* expression levels

3. **blaTEM-1B and aztreonam:**
   - 4-fold higher aztreonam MICs in *blaTEM-1B*-positive isolates
   - Consistent with the known aztreonam-hydrolyzing activity of some TEM variants

4. **Limited impact of ESBLs on carbapenems:**
   - Neither *BlaCTXM-15* nor *blaSHV-28* showed strong associations with carbapenem MICs
   - Carbapenem resistance is dominated by *blaKPC-31* in this collection

:::{.callout-note}
## Statistical Power Considerations

While several associations show large effect sizes (fold changes >2), limited sample sizes for rarer genes reduce statistical power. Associations with p-values between 0.05-0.10 should be considered hypothesis-generating and warrant validation in larger datasets.
:::

## Gene Combinations and Multi-Drug Resistance

### Common Gene Profiles

```{r}
#| label: tbl-gene-combinations
#| tbl-cap: "Most common beta-lactamase gene combinations (≥3 isolates)"

combinations <- data.frame(
  Profile = c("None (KPC-31 only)", 
              "CTX-M-15 + TEM-1B + SHV-28 + OXA-1",
              "Others (n<3 each)"),
  n_isolates = c(19, 4, 19),
  Percentage = c(45.2, 9.5, 45.2),
  Species_KP = c(12, 4, 17),
  Species_EC = c(7, 0, 2),
  CAZ_AVI_median = c(64.0, 12.0, "Variable")
)

kable(combinations,
      col.names = c("Gene Profile", "Isolates", "%", "K. pneumoniae", 
                    "E. coli", "CAZ-AVI median (mg/L)"),
      align = c("l", "r", "r", "r", "r", "r")) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

**Insights:**

1. **KPC-31-only isolates (45%):**
   - Median CAZ-AVI MIC = 64 mg/L (range: 4-256)
   - Wide MIC range suggests variability in *blaKPC-31* expression or genetic context
   - Found in both species (12 KP, 7 EC)

2. **Quadruple-gene profile (9.5%):**
   - *BlaCTXM-15 + blaTEM-1B + blaSHV-28 + blaOXA-1*
   - Exclusive to *K. pneumoniae*
   - Surprisingly, shows **lower** CAZ-AVI MICs (median 12 mg/L)
   - May represent a specific clonal lineage with altered *blaKPC-31* activity

3. **Gene burden vs. resistance:**
   - No clear linear relationship between gene count and MIC values
   - Isolates with 4-5 genes show median CAZ-AVI MICs of 18-22 mg/L
   - Isolates with 1 gene show median CAZ-AVI MIC of 256 mg/L
   - **Conclusion:** Specific gene identity and genomic context matter more than gene count

### Gene Burden and Phenotype

```{r}
#| label: fig-burden-vs-mic
#| fig-cap: "Relationship between beta-lactamase gene burden and CAZ-AVI susceptibility"
#| fig-width: 10
#| fig-height: 6

burden_mic_data <- data.frame(
  n_genes = rep(c(0, 1, 2, 3, 4, 5, 6), c(19, 7, 1, 4, 8, 2, 1)),
  CAZ_AVI = c(4, 4, 12, 12, 12, 12, 12, 12, 16, 24, 24, 32, 32, 32, 48, 48, 64, 64, 128, 256, 256,
              32, 64, 128, 256, 256, 644, 644,
              256,
              32, 64, 256, 256,
              12, 12, 18, 20, 24, 32, 64, 256,
              12, 32,
              164)
)

ggplot(burden_mic_data, aes(x = factor(n_genes), y = log2(CAZ_AVI + 0.1))) +
  geom_boxplot(fill = "#2C7FB8", alpha = 0.6, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.5, size = 2.5, color = "#2C7FB8") +
  labs(title = "CAZ-AVI Susceptibility by Beta-lactamase Gene Burden",
       subtitle = "No clear linear relationship between gene count and resistance level",
       x = "Number of Additional Beta-lactamase Genes (excluding KPC-31)",
       y = "log2(CAZ-AVI MIC in mg/L)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

## Species-Specific Phenotypic Profiles

### Antimicrobial Susceptibility Comparison

```{r}
#| label: tbl-species-mic-comparison
#| tbl-cap: "Comparison of median MIC values between K. pneumoniae and E. coli"

species_mics <- data.frame(
  Antibiotic = c("CAZ-AVI", "Ceftazidime", "Cefepime", "Aztreonam", 
                 "Ceftolozane-tazobactam", "Piperacillin-tazobactam", 
                 "Meropenem", "Imipenem"),
  KP_median = c(48.0, 32.0, 16.0, 32.0, 84.0, 324.0, 2.0, 1.0),
  KP_range = c("[12-644]", "[32-256]", "[16-16]", "[4-32]", "[84-84]", 
               "[16-1284]", "[0.1-16]", "[0.2-1.5]"),
  EC_median = c(128.0, 32.0, 1.0, 8.5, 84.0, 44.0, 0.2, 1.0),
  EC_range = c("[4-164]", "[16-256]", "[0.5-16]", "[1-16]", "[84-84]",
               "[8-164]", "[0.1-12]", "[0-1]"),
  p_value = c(0.3685, 1.0000, 0.0707, 0.0567, NA, 0.0623, 0.8624, 0.4283)
)

kable(species_mics,
      col.names = c("Antibiotic", "K. pneumoniae Median", "Range", 
                    "E. coli Median", "Range", "p-value"),
      align = c("l", "r", "l", "r", "l", "r"),
      digits = 4) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) |>
  column_spec(6, background = ifelse(species_mics$p_value < 0.1, "#FFF3CD", "white"))
```

**Observations:**

- **No statistically significant differences** at p<0.05 threshold
- **Trends approaching significance:**
  - Cefepime: KP higher (p=0.071)
  - Aztreonam: KP higher (p=0.057)
  - Piperacillin-tazobactam: KP higher (p=0.062)

- **CAZ-AVI susceptibility:**
  - *K. pneumoniae* median = 48 mg/L (lower)
  - *E. coli* median = 128 mg/L (higher)
  - Large within-species variability prevents statistical significance

:::{.callout-tip}
## Clinical Implications

Despite similar *blaKPC-31* carriage, the trend toward higher beta-lactam MICs in *K. pneumoniae* (particularly for aztreonam and piperacillin-tazobactam) likely reflects the higher prevalence of ESBLs (*BlaCTXM-15*, *blaSHV-28*) in this species. However, individual isolate testing remains essential due to substantial within-species heterogeneity.
:::

## Summary and Conclusions

### Key Genotype-Phenotype Relationships

1. **Universal KPC-31, variable accessory resistome:**
   - All isolates carry *blaKPC-31*, but 55% carry additional beta-lactamases
   - Accessory genes show strong species-specificity

2. **Species-specific gene acquisition:**
   - *K. pneumoniae* preferentially acquires ESBLs (*BlaCTXM-15*, *blaSHV-28*)
   - *E. coli* shows enrichment for OXA variants (*bla_OXA-9*, *bla_OXA-18*)

3. **Context-dependent phenotypic impact:**
   - Specific genes (e.g., *bla_TEM-1*) show associations with CAZ-AVI resistance
   - Gene burden does not predict resistance level
   - Genetic background and gene expression likely modulate phenotype

4. **Paradoxical associations:**
   - *blaOXA-1* associated with **lower** CAZ-AVI MICs
   - Suggests complex interactions and potential fitness trade-offs

### Clinical and Research Implications

:::{.callout-important}
## Key Messages for Clinical Practice

1. **Genotype does not fully predict phenotype:** Direct susceptibility testing remains essential, as MIC values vary widely even among isolates with identical beta-lactamase gene profiles.

2. **CAZ-AVI variability:** The wide range of CAZ-AVI MICs (4-644 mg/L) despite universal *blaKPC-31* carriage highlights the importance of individual testing when considering this therapeutic option.

3. **Species matters:** *K. pneumoniae* isolates may have higher beta-lactam MICs due to ESBL co-carriage, though individual variation is substantial.
:::

### Future Directions

1. **Expression analysis:** mRNA/protein level quantification of *blaKPC-31* and accessory genes to understand phenotypic variability

2. **Genomic context analysis:** Investigate plasmid types, insertion sequences, and promoter regions that may affect gene expression

3. **Fitness cost assessment:** Evaluate whether multi-gene carriage imposes fitness costs that could explain paradoxical susceptibility patterns

4. **Expanded cohort validation:** Test observed associations in larger, independent collections

---

**Analysis date:** `{r} Sys.Date()`  
**Isolates analyzed:** 42 (33 *K. pneumoniae*, 9 *E. coli*)  
**Beta-lactamase genes examined:** 13 (excluding universal *blaKPC-31*)  
**Antibiotics tested:** 28
